<!doctype html>
<html lang="en">
<head>
<title>Mechanisms of AI Protein Folding in ESMFold</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="Mechanistic interpretability analysis of how ESMFold predicts protein structure from sequence" />
<meta property="og:title" content="Mechanisms of AI Protein Folding in ESMFold" />
<meta property="og:description" content="Mechanistic interpretability analysis of how ESMFold predicts protein structure from sequence" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" /> 
<meta name="twitter:title" content="Mechanisms of AI Protein Folding in ESMFold" />
<meta name="twitter:description" content="Mechanistic interpretability analysis of how ESMFold predicts protein structure from sequence" />
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Math&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
<link href="style.css" rel="stylesheet">

<!-- KaTeX for math rendering -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

<style>
.relatedthumb {
  float:left; width: 200px; margin: 3px 10px 7px 0;
}
.relatedblock {
  clear: both;
  display: inline-block;
}
.bold-sc {
  font-variant: small-caps;
  font-weight: bold;
}
.cite, .citegroup {
  margin-bottom: 8px;
}
:target {
  background-color: yellow;
}

/* Green biology theme */
.nd-pageheader {
  background-color: #1b9e77 !important;
  color: #000 !important;
}
.nd-pageheader h1, .nd-pageheader address {
  color: #000 !important;
}
.nd-pagefooter {
  background-color: #1b9e77 !important;
  color: #000 !important;
}
.nd-pagefooter a {
  color: #000 !important;
}

/* Math styling */
.katex { font-size: 1.1em; }
.katex-display { margin: 1em 0; overflow-x: auto; }

/* Citation links */
a.citation-link {
  color: #0066cc;
  text-decoration: none;
}

/* Equation labels */
.equation-label {
  float: right;
  color: #666;
  font-size: 0.9em;
}

/* Stage color coding */
.stage-early { color: #D95F02; }
.stage-late { color: #1B7F3A; }

/* Two-column figure layout */
.row figure {
  margin-bottom: 20px;
}
.row figure figcaption {
  font-size: 0.9em;
  margin-top: 10px;
}
</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FD12LWN557"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-FD12LWN557');
</script>

</head>
<body class="nd-docs">
<div class="nd-pageheader">
 <div class="container">
 <h1 class="lead">
 Mechanisms of AI Protein Folding in ESMFold
 </h1>
<address>
  <nobr>Kevin Lu<sup>1</sup>,</nobr>
  <nobr>Jannik Brinkmann<sup>1,2</sup>,</nobr>
  <nobr>Stefan Huber<sup>3</sup>,</nobr>
  <nobr>Aaron Mueller<sup>4</sup>,</nobr>
  <nobr>Yonatan Belinkov<sup>5</sup>,</nobr>
  <nobr>David Bau<sup>1</sup>,</nobr>
  <nobr>Chris Wendler<sup>1</sup></nobr>
 <br>
  <nobr><sup>1</sup>Northeastern University,</nobr>
  <nobr><sup>2</sup>TU Clausthal,</nobr>
  <nobr><sup>3</sup>Harvard University,</nobr>
  <nobr><sup>4</sup>Boston University,</nobr>
  <nobr><sup>5</sup>Technion</nobr>
</address>
 </div> 
</div><!-- end nd-pageheader -->
 
<div class="container">
<div class="row justify-content-center text-center">

<p>
<a href="https://arxiv.org/pdf/XXXX.XXXXX.pdf" class="d-inline-block p-3 align-top" target="_blank"><img height="100" width="78" src="images/paper-thumb.png" style="border:1px solid; margin: 0 38px;" alt="ArXiv Preprint thumbnail" data-nothumb=""><br>ArXiv<br>Preprint</a>
<!-- <a href="https://github.com/" class="d-inline-block p-3 align-top" target="_blank"><img height="100" width="78" src="images/code-thumb.png" style="border:1px solid; margin: 0 38px;" alt="Github code thumbnail" data-nothumb=""><br>Source Code<br>Github</a> -->
</p>

<div class="card" style="max-width: 1020px;">
<div class="card-block">
<h3>Abstract</h3>
<p>
How do protein structure prediction models fold proteins? We investigate this question by tracing how ESMFold folds a beta hairpin, a prevalent structural motif. Through counterfactual interventions on model latents, we identify two computational stages in the folding trunk. In the first stage, early blocks initialize <em class="stage-early">pairwise biochemical signals</em>: residue identities and associated biochemical features like charge flow from sequence representations into pairwise representations. In the second stage, late blocks develop <em class="stage-late">pairwise spatial features</em>: distance and contact information accumulate in the pairwise representation. We demonstrate that the mechanisms underlying structural decisions of ESMFold can be localized, traced through interpretable representations, and manipulated with strong causal effects.
</p>



</div><!--card-block-->
</div><!--card-->

</div><!--row-->
  
<div class="row">
<div class="col">

    <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/Figure1.png" style="width:100%; max-width:800px"></center>
  <figcaption><strong>Figure 1: Two computational stages in the ESMFold folding trunk.</strong> We identify which latent representations in the model influence hairpin formation by patching activations from a hairpin protein into a helical protein at each block of the trunk, then measuring whether the output folds as a hairpin. <span class="stage-early">Sequence patches (orange)</span> induce hairpin formation in early blocks (0&ndash;7); <span class="stage-late">pairwise patches (green)</span> are effective in late blocks, with results aggregated over 2000 experiments. We show that stage 1 propagates biochemical features (e.g., charge) from sequence into pairwise representations, while stage 2 develops pairwise spatial features (distances, contacts) that modulate sequence attention and control output geometry.</figcaption>
  </figure>

<h2>Introduction</h2>

<p>
How do protein folding models fold proteins? We study these questions in ESMFold. Like AlphaFold2, OpenFold, and Boltz-2, ESMFold is built around a <em>folding trunk</em>, the architectural component in which sequence becomes structure. The trunk iteratively refines a sequence representation while building a pairwise representation that encodes relationships between residues; a structure module then decodes these into 3D coordinates. Mechanistically understanding these learned computations could inform how we interact with, diagnose, and build on this entire class of models.
</p>

<p>
In this work, we conduct the first mechanistic analysis of a protein model folding trunk and focus on how it folds a simple and prevalent structural motif: the beta hairpin. We use activation patching to transplant sequence and pairwise representations from a donor protein containing a beta hairpin into a target protein containing an alpha-helical region. By observing whether the patched trunk produces a hairpin in the target region, we find that ESMFold folds a hairpin in two computational stages.
</p>

<p>
In the first stage, early blocks initialize pairwise biochemical signals: residue identities and associated biochemical features like charge flow from sequence representations into pairwise representations. In the second stage, late blocks develop pairwise spatial features: distance and contact information accumulate in the pairwise representation.
</p>
<h2>Background</h2>

<h3>Protein Structure</h3>

  <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/betaHairpin.jpg" style="width:100%; max-width:400px"></center>
  <figcaption><strong>Beta-hairpin structure.</strong> A simple protein motif consisting of two antiparallel beta strands connected by a tight turn. Backbone atoms are shown with hydrogen bonds (dashed lines) stabilizing the sheet structure, and C$_\alpha$&ndash;C$_\alpha$ distances are commonly used to measure inter-residue distances.</figcaption>
  </figure>

<p>
<strong>Chains of amino acids.</strong> Proteins are linear polymers of amino acids, each with a central carbon (C$_\alpha$) bonded to a backbone (N-C-C) and a variable sidechain. The sequence of amino acids defines the protein's primary structure.
</p>

<p>
<strong>Secondary structure.</strong> Local regions of the backbone adopt regular conformations stabilized by hydrogen bonds. The two most common secondary structures are alpha-helices (spiral structures) and beta-sheets (extended strands). A beta-hairpin consists of two adjacent antiparallel beta strands connected by a tight turn.
</p>

<h3>Protein Structure Prediction with ESMFold</h3>

<p>
ESMFold <a href="#ref-lin2023" class="citation-link">[Lin et al., 2023]</a> predicts protein structure from sequence alone using a two-stage architecture:
</p>

  <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/esmfold_architecture.png" style="width:80%; max-width:800px"></center>
  <figcaption><strong>Figure 1: ESMFold Architecture.</strong> The model consists of (1) ESM-2 language model that embeds the sequence, (2) Folding Trunk that processes sequence and pairwise representations through multiple blocks, and (3) Structure Module that converts pairwise features into 3D coordinates.</figcaption>
  </figure>

<p>
<strong>Module 1: ESM-2 Language Model.</strong> The input sequence is first processed by ESM-2, a 3B-parameter transformer pretrained on 250M protein sequences. ESM-2 produces a contextualized embedding $s_i \in \mathbb{R}^{2560}$ for each residue position $i$, capturing evolutionary and structural patterns learned during pretraining.
</p>

<p>
<strong>Module 2: Folding Trunk.</strong> The core of ESMFold is a folding trunk consisting of 48 stacked blocks. Each block maintains two representations:
</p>

<ul>
<li>Sequence representation $s_i$ (per-residue features)</li>
<li>Pairwise representation $z_{ij}$ (features for each residue pair)</li>
</ul>



<p>
Each folding block performs the following operations:
</p>

  <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/esmfold_foldingtrunk.png" style="width:100%; max-width:700px"></center>
  <figcaption><strong>Folding trunk detail.</strong> The trunk consists of 48 repeating blocks, each processing both sequence and pairwise representations.</figcaption>
  </figure>

<p>
<strong>Sequence-to-Pair (Seq2Pair):</strong> Projects sequence features into pairwise space:
</p>

$$z_{ij} \leftarrow z_{ij} + W_{\text{out}} \cdot \text{ReLU}(W_i s_i + W_j s_j + b)$$

<p>
</p>

<p>
<strong>Pair2Seq:</strong> Aggregates pairwise features back to sequence space:
</p>

$$s_i \leftarrow s_i + W_{\text{out}} \sum_j \alpha_{ij} V_{ij}$$

<p>
where $\alpha_{ij}$ are attention weights and $V_{ij} = W_V z_{ij}$.
</p>

<p>
<strong>Triangle updates and attention:</strong> The pairwise representation is updated using triangle multiplicative updates (inspired by AlphaFold2) and row/column attention to propagate constraints across the 2D grid.
</p>

<p>
<strong>Stage 3: Structure Module.</strong> After 48 folding blocks, the final pairwise representation $z_{ij}$ is passed to a structure module that predicts 3D coordinates.
</p>

<h2>When Does the Model Fold a Hairpin?</h2>

<p>
We use activation patching to localize where hairpin formation is computed in the folding trunk. We select a <strong>donor protein</strong> containing a beta hairpin and a <strong>target protein</strong> containing a helix-turn-helix motif. We run both proteins through ESMFold, extracting the sequence representation $s$ and pairwise representation $z$ at each block of the folding trunk. During the target's forward pass, we replace representations in the target's helical region with the donor's hairpin representations, aligning the two regions at their loop positions. We then observe whether the output structure contains a hairpin in the patched region.
</p>

    <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/FigureCActivationPatchingDraft4.png" style="width:100%; max-width:800px"></center>
  <figcaption><strong>Figure 3: Activation Patching Setup.</strong> We run a donor protein containing a beta hairpin through ESMFold and extract the sequence (orange) and pairwise (green) representations of the hairpin region. During the forward pass of a target protein containing a helix-turn-helix motif, we replace the target's representations with the donor's hairpin representations at a single block, then measure if the output contains a hairpin.</figcaption>
  </figure>

<p>
<strong>Dataset construction.</strong> We curated a dataset of 106 target proteins consisting of alpha-helical structures from diverse protein families. For donor hairpins, we assembled a dataset of about 80,000 beta hairpins extracted from the Protein Data Bank. Each hairpin consists of two strands (5&ndash;10 residues each) connected by a short loop (2&ndash;5 residues). We identified internal loop regions in each target protein, then sampled 10 donor hairpins per loop, yielding about 5,000 patching experiments in total.
</p>

<p>
<strong>Full patching establishes feasibility.</strong> We first verify that patching can induce hairpin formation by patching both sequence and pairwise representations across all 48 blocks of the folding trunk. Approximately 40% of patches (~2,000 cases) successfully produce a hairpin in the target region, as measured by DSSP secondary structure assignment.
</p>

<p>
<strong>Single-block patching reveals two regimes.</strong> To localize the computation, we patch at a single block $k$, patching either sequence or pairwise representations alone. Restricting to the ~2,000 cases where full patching succeeded, we measure the success rate for each block and representation type:
</p>

<ul>
<li><span class="stage-early"><strong>Sequence patches</strong> are effective in early blocks (0-7), with success rates peaking around 40% at block 0 and declining thereafter.</span></li>
<li><span class="stage-late"><strong>Pairwise patches</strong> show the opposite pattern: they only become effective starting around block 25, reaching success rates around 20% by block 35.</span></li>
</ul>

<p>
This reveals two distinct computational stages: <span class="stage-early">early blocks where sequence information drives hairpin formation</span>, and <span class="stage-late">late blocks where pairwise representations take over</span>.
</p>

<h2>Early Blocks: Building Pairwise Chemistry</h2>

<h3>Sequence Information Flows Into Pairwise Space</h3>

<p>
Why does sequence patching only work in early blocks? We hypothesize that early blocks serve the critical role of transferring information from $s$ into $z$ via the <strong>seq2pair</strong> pathway, populating $z$ before downstream computations begin.
</p>

  <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/Figure2.png" style="width:100%; max-width:800px"></center>
  <figcaption><strong>Figure 4: Information Flow Analysis.</strong> (a) Shift in representations under different interventions. Sequence patching at block 0 leads to pairwise representation alignment with the donor. Freezing seq2pair prevents this alignment. (b) Ablating seq2pair in early blocks dramatically reduces hairpin formation during sequence patching.</figcaption>
  </figure>

<p>
<strong>Representation similarity.</strong> After patching sequence at block 0, we track how the pairwise representation changes across blocks. We find that $z$ rapidly becomes donor-like in the first ~10 blocks, then changes only gradually afterward. This suggests a short early "write-in" window during which sequence-level information is transferred into $z$.
</p>

<p>
<strong>Pathway ablations.</strong> We confirm that seq2pair is necessary for hairpin formation by performing sliding-window ablations. <span class="stage-early">Ablating seq2pair in blocks 0&ndash;20 dramatically reduces hairpin formation; ablating it in later blocks has little effect.</span> This confirms that sequence patches work because they propagate into $z$ via seq2pair during early blocks.
</p>

<h3>Which Sequence Features are Propagated?</h3>

<p>
We investigate whether the model leverages biochemical features to guide folding. We focus on <strong>charge</strong>, which is biochemically relevant for hairpin stability: antiparallel beta strands are often stabilized by salt bridges between oppositely charged residues on facing positions.
</p>

  <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/Figure6ChargeBoomDraft4.png" style="width:100%; max-width:800px"></center>
  <figcaption><strong>Figure 5: Electrostatic Complementarity Steering.</strong> (a) We steer the sequence representation toward opposite charges on the two helical regions flanking the loop. (b) Steering in early blocks (0&ndash;10) is most effective at inducing hydrogen bond formation. (c) Control: same-charge steering increases cross-strand distance, opposite-charge steering decreases it.</figcaption>
  </figure>

<p>
<strong>Charge is linearly encoded.</strong> We use a difference-in-means approach to identify a "charge direction" in the sequence representation space. Let $\mathcal{P} = \{\text{K}, \text{R}, \text{H}\}$ denote positively charged residues and $\mathcal{N} = \{\text{D}, \text{E}\}$ denote negatively charged residues. We compute:
</p>

$$v_{\text{charge}} = \frac{\bar{s}_{\mathcal{P}} - \bar{s}_{\mathcal{N}}}{\|\bar{s}_{\mathcal{P}} - \bar{s}_{\mathcal{N}}\|}$$

<p>
Projecting residue representations onto $v_{\text{charge}}$ shows clean separation between charge classes at early blocks, confirming that charge is linearly encoded.
</p>

<p>
<strong>Electrostatic complementarity steering.</strong> Because this direction is linear, we can manipulate it. For a target helix-turn-helix region, we steer one helix toward positive charge and the other toward negative charge, mimicking the electrostatic complementarity of natural hairpins:
</p>

$$s_i' = s_i \pm \alpha \cdot v_{\text{charge}}$$

<p>
<strong>Result:</strong> <span class="stage-early">Complementarity steering induces hydrogen bond formation, with the effect concentrated in early blocks (0&ndash;10).</span> As a control, steering both strands to the same charge increases cross-strand distance (repulsion), while opposite charges decrease it (attraction). This confirms that the charge direction causally influences predicted geometry.
</p>

<h2>Late Blocks: Pairwise Geometry Emerges</h2>

<h3>Pairwise Representation Encodes Distance</h3>

<p>
By the late blocks, sequence patching no longer induces hairpin formation, but pairwise patching does. This suggests that the pairwise representation $z$ has taken over as the primary carrier of folding-relevant information. We hypothesize that $z$ encodes spatial relationships—particularly pairwise distances.
</p>

 <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/Figure7ContactSteeringDraft12.png" style="width:100%; max-width:800px"></center>
  <figcaption><strong>Figure 6: Distance Encoding and Steering.</strong> (a) $R^2$ score of linear distance probes reaches ~0.9 at late blocks. (b) Hydrogen bond formation peaks when steering blocks 20&ndash;35. (c) Steering setup: we steer cross-strand residue pairs toward a target distance of 5.5&Aring;.</figcaption>
  </figure>

<p>
<strong>Distance probing.</strong> We train linear probes to predict pairwise C$_\alpha$ distance from $z$ at each block. Even at block 0, $z$ contains some distance information from positional embeddings. But as $z$ is populated with sequence information and refined through triangular updates, <span class="stage-late">probe accuracy increases substantially, reaching $R^2 \approx 0.9$ by late blocks</span>.
</p>

<p>
<strong>Distance steering.</strong> Since the probe is linear, we can steer toward a target distance (5.5&Aring;, the typical C$_\alpha$&ndash;C$_\alpha$ spacing for cross-strand contacts in beta-sheets) by moving along the probe's weight direction:
</p>

$$z'_{ij} = z_{ij} - \alpha \cdot \mathbf{w}$$

<p>
<strong>Result:</strong> <span class="stage-late">Steering in blocks 20&ndash;35 is most effective, with hydrogen bond formation peaking around 40%.</span> Steering in early blocks is less effective both because probes are less accurate and because subsequent computation can overwrite the perturbation. This confirms that late $z$ causally determines geometric outputs.
</p>

<h3>Pair2Seq Promotes Contact Information</h3>

<p>
How does distance information in $z$ influence the rest of the computation? The pair2seq pathway projects $z$ to produce a scalar bias that modulates sequence self-attention.
</p>
  <figure class="center_image" style="margin-top: 30px;">
    <center><img src="images/paper/Figure4Wide.png" style="width:100%; max-width:900px"></center>
    <figcaption><strong>Figure 7: Pair2Seq Bias and Patching Effects.</strong> (a) ROC-AUC for classifying contacts (C$_\alpha$ &lt; 8&Aring;) vs. non-contacts using bias values alone. The pair2seq bias cleanly separates contacts in middle and late blocks. (b) Heatmap of attention bias values (red = positive, blue = negative) with green contours showing residue pairs within 8&Aring;. (c) After patching $z$, attention shifts toward donor contacts and away from target contacts. (d) Ablating the pair2seq bias after patching results in minor drops in hairpin formation.</figcaption>
  </figure>

<p>
<strong>Bias encodes contacts.</strong> In middle and late blocks, the pair2seq bias cleanly separates contacting residue pairs (C$_\alpha$ distance &lt; 8&Aring;) from non-contacts. <span class="stage-late">Residue pairs in contact receive substantially more positive bias than non-contacts</span>, encouraging the sequence attention to preferentially mix information between contacting residues. We visualize the bias values across blocks in the <a href="#appendix-bias-maps">Appendix</a>, along with per-head biases which show distinct patterns and suggest head specialization as an area for future investigation.
</p>

<p>
<strong>Causal role.</strong> We tested this by patching the pairwise representation at block 27 and measuring how sequence attention changes. <span class="stage-late">After patching, attention to donor-unique contacts increases substantially (up to 400%), while attention to target-unique contacts decreases.</span> The pairwise representation causally redirects which residues attend to each other.
</p>

<h3>The Structure Module Uses Z as a Distance Map</h3>

<p>
The pair2seq pathway is one route by which $z$ influences the output. But $z$ also feeds directly into the structure module, which produces the final 3D coordinates.
</p>

  <figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/Figure5StructureModuleScalingDraft12.png" style="width:100%; max-width:700px"></center>
  <figcaption><strong>Figure 8: Structure Module Scaling Experiment.</strong> (a) Effect of scaling $z$ versus $s$ on mean pairwise C$_\alpha$ distance. Scaling $z$ monotonically scales the output structure; scaling $s$ has virtually no effect. (b) Example structures at different pairwise scaling factors.</figcaption>
  </figure>

<p>
<strong>Scaling experiment.</strong> We scaled the pairwise representation by factors ranging from 0 to 2 before it enters the structure module, while holding $s$ fixed. We then repeated the experiment scaling $s$ while holding $z$ fixed.
</p>

<p>
<strong>Result:</strong> <span class="stage-late">Scaling $z$ monotonically scales the mean pairwise distance between residues in the output structure.</span> Scaling up causes the protein to expand; scaling down causes it to contract. In contrast, scaling $s$ has virtually no effect on output geometry. Together with our steering experiments, this confirms that $z$ acts as a geometric blueprint that the structure module renders into 3D coordinates.
</p>


<h2>References</h2>

<div id="ref-anfinsen1973" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Anfinsen, C. B. (1973). Principles that govern the folding of protein chains. <em>Science</em>, 181(4096), 223-230.
</p>
</div>

<div id="ref-jumper2021" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Jumper, J., Evans, R., Pritzel, A., Green, T., Figurnov, M., Ronneberger, O., ... & Hassabis, D. (2021). Highly accurate protein structure prediction with AlphaFold. <em>Nature</em>, 596(7873), 583-589.
</p>
</div>

<div id="ref-lin2023" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Lin, Z., Akin, H., Rao, R., Hie, B., Zhu, Z., Lu, W., ... & Rives, A. (2023). Evolutionary-scale prediction of atomic-level protein structure with a language model. <em>Science</em>, 379(6637), 1123-1130.
</p>
</div>

<div id="ref-olah2020" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Olah, C., Cammarata, N., Schubert, L., Goh, G., Petrov, M., & Carter, S. (2020). Zoom in: An introduction to circuits. <em>Distill</em>, 5(3), e00024-001.
</p>
</div>

<div id="ref-meng2022" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Meng, K., Bau, D., Andonian, A., & Belinkov, Y. (2022). Locating and editing factual associations in GPT. <em>Advances in Neural Information Processing Systems</em>, 35, 17359-17372.
</p>
</div>

<div id="ref-vig2020" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Vig, J., Madani, A., Varshney, L. R., Xiong, C., Socher, R., & Rajani, N. F. (2020). BERTology meets biology: Interpreting attention in protein language models. <em>arXiv preprint arXiv:2006.15222</em>.
</p>
</div>

<div id="ref-wang2022" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Wang, K., Variengien, A., Conmy, A., Shlegeris, B., & Steinhardt, J. (2022). Interpretability in the wild: a circuit for indirect object identification in GPT-2 small. <em>arXiv preprint arXiv:2211.00593</em>.
</p>
</div>

<div id="ref-munoz1997" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Muñoz, V., Thompson, P. A., Hofrichter, J., & Eaton, W. A. (1997). Folding dynamics and mechanism of β-hairpin formation. <em>Nature</em>, 390(6656), 196-199.
</p>
</div>

<div id="ref-dill2008" class="cite">
<p style="text-indent: -3em; margin-left: 3em;">
Dill, K. A., Ozkan, S. B., Shell, M. S., & Weikl, T. R. (2008). The protein folding problem. <em>Annual Review of Biophysics</em>, 37, 289-316.
</p>
</div>

<h2>How to cite</h2>

<p>The paper can be cited as follows.</p>

<div class="card">
<h3 class="card-header">bibliography</h3>
<div class="card-block">
<p style="text-indent: -3em; margin-left: 3em;" class="card-text clickselect">
Lu, K., Brinkmann, J., Huber, S., Mueller, A., Belinkov, Y., Bau, D., &amp; Wendler, C. (2026). Mechanisms of AI Protein Folding in ESMFold. <em>arXiv preprint arXiv:xxxx.xxxxx</em>.
</p>
</div>
<h3 class="card-header">bibtex</h3>
<div class="card-block">
<pre class="card-text clickselect">
@article{lu2026mechanisms,
  title={Mechanisms of AI Protein Folding in ESMFold},
  author={Lu, Kevin and Brinkmann, Jannik and Huber, Stefan and Mueller, Aaron and Belinkov, Yonatan and Bau, David and Wendler, Chris},
  journal={arXiv preprint arXiv:xxxx.xxxxx},
  year={2026}
}
</pre>
</div>
</div>


<h2 id="appendix-bias-maps">Appendix: Bias Maps</h2>

<p>
We visualize the pair2seq attention bias across blocks and across individual attention heads. For a single protein (PDB: 6rwc), we extract the bias term $\beta_{ij}(z_{ij})$ and average over heads. Green contours indicate structural contacts (C$_\alpha$ distance &lt; 8&Aring;).
</p>

<h3>Bias Across Blocks (Head-Averaged)</h3>

<p>
Each panel shows the bias term $\beta_{ij}$, averaged across all 8 attention heads, for protein 6rwc at selected blocks of the folding trunk. Red indicates positive bias (encouraging attention); blue indicates negative bias. In early blocks, the bias is near-uniform; by the middle blocks, it begins to align with the contact map, and by late blocks, contacting residue pairs receive substantially higher bias than non-contacts.
</p>

<div class="row">
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block00_avg.png" style="width:100%"><p class="text-center"><small>Block 0</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block04_avg.png" style="width:100%"><p class="text-center"><small>Block 4</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block08_avg.png" style="width:100%"><p class="text-center"><small>Block 8</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block12_avg.png" style="width:100%"><p class="text-center"><small>Block 12</small></p></div>
</div>
<div class="row">
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block16_avg.png" style="width:100%"><p class="text-center"><small>Block 16</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block20_avg.png" style="width:100%"><p class="text-center"><small>Block 20</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block24_avg.png" style="width:100%"><p class="text-center"><small>Block 24</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block28_avg.png" style="width:100%"><p class="text-center"><small>Block 28</small></p></div>
</div>
<div class="row">
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_avg.png" style="width:100%"><p class="text-center"><small>Block 32</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block36_avg.png" style="width:100%"><p class="text-center"><small>Block 36</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block40_avg.png" style="width:100%"><p class="text-center"><small>Block 40</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block44_avg.png" style="width:100%"><p class="text-center"><small>Block 44</small></p></div>
</div>

<h3>Per-Head Bias at Block 32</h3>

<p>
Individual attention head bias values for protein 6rwc at block 32. Different heads exhibit distinct patterns: some heads show strong contact-aligned bias, while others capture different spatial relationships or show more diffuse patterns. This specialization suggests that individual heads attend to complementary aspects of pairwise geometry.
</p>

<div class="row">
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_head0.png" style="width:100%"><p class="text-center"><small>Head 0</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_head1.png" style="width:100%"><p class="text-center"><small>Head 1</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_head2.png" style="width:100%"><p class="text-center"><small>Head 2</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_head3.png" style="width:100%"><p class="text-center"><small>Head 3</small></p></div>
</div>
<div class="row" style="margin-bottom: 30px;">
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_head4.png" style="width:100%"><p class="text-center"><small>Head 4</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_head5.png" style="width:100%"><p class="text-center"><small>Head 5</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_head6.png" style="width:100%"><p class="text-center"><small>Head 6</small></p></div>
  <div class="col-md-3 col-sm-6"><img src="images/paper/bias_maps/6rwc_block32_head7.png" style="width:100%"><p class="text-center"><small>Head 7</small></p></div>
</div>


</div>
</div><!--row -->
</div> <!-- container -->

<footer class="nd-pagefooter">
  <div class="row">
    <div class="col-6 col-md text-center">
      <a href="https://baulab.info/">About the Bau Lab</a>
    </div>
  </div>
</footer>

</body>
<script>
// KaTeX auto-render initialization
document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "$$", right: "$$", display: true},
      {left: "$", right: "$", display: false}
    ],
    throwOnError: false
  });
});

// Clickselect for citations
$(document).on('click', '.clickselect', function(ev) {
  var range = document.createRange();
  range.selectNodeContents(this);
  var sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
});
</script>
</html>

